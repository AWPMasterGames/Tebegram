@echo off
chcp 65001 >nul
title üåê LocalTunnel Smart Start
color 0B

echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë          üåê SMART LOCALTUNNEL LAUNCHER         ‚ïë
echo ‚ïë                                                ‚ïë
echo ‚ïë  –ü–æ–ø—Ä–æ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—É–±–¥–æ–º–µ–Ω–æ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É     ‚ïë
echo ‚ïë  –¥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è                      ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

REM –°–ø–∏—Å–æ–∫ —Å—É–±–¥–æ–º–µ–Ω–æ–≤ –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏
set SUBDOMAINS=tebegrammmm tebegram-server tebegram-chat tebegram-msg tebegram-app

echo üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 5000...
curl -s http://localhost:5000 >nul 2>&1
if errorlevel 1 (
    echo ‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000!
    echo    –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: dotnet run
    pause
    exit /b 1
)
echo ‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000

echo.
echo üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Å—É–±–¥–æ–º–µ–Ω–∞...

REM –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—É–±–¥–æ–º–µ–Ω–∞–º–∏
for %%s in (%SUBDOMAINS%) do (
    echo.
    echo üîÑ –ü—Ä–æ–±—É–µ–º —Å—É–±–¥–æ–º–µ–Ω: %%s
    echo    URL –±—É–¥–µ—Ç: http://%%s.loca.lt
    
    REM –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ª–æ–≥–∞ —ç—Ç–æ–π –ø–æ–ø—ã—Ç–∫–∏
    set ATTEMPT_LOG=%TEMP%\lt_attempt_%%s.log
    
    REM –ó–∞–ø—É—Å–∫–∞–µ–º LocalTunnel —Å —Ç–∞–π–º–∞—É—Ç–æ–º
    timeout /t 1 /nobreak >nul
    echo yes | lt --port 5000 --subdomain %%s > "%TEMP%\lt_attempt_%%s.log" 2>&1 &
    
    REM –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    echo ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (10 —Å–µ–∫)...
    timeout /t 10 /nobreak >nul
    
    REM –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª—Å—è –ª–∏ URL –≤ –ª–æ–≥–µ
    if exist "%TEMP%\lt_attempt_%%s.log" (
        findstr /C:"your url is" "%TEMP%\lt_attempt_%%s.log" >nul 2>&1
        if not errorlevel 1 (
            echo ‚úÖ –£–°–ü–ï–•! –ù–∞–π–¥–µ–Ω —Å–≤–æ–±–æ–¥–Ω—ã–π —Å—É–±–¥–æ–º–µ–Ω: %%s
            
            REM –ò–∑–≤–ª–µ–∫–∞–µ–º URL –∏–∑ –ª–æ–≥–∞
            for /f "tokens=*" %%u in ('findstr /C:"your url is" "%TEMP%\lt_attempt_%%s.log"') do (
                echo üåê –ü—É–±–ª–∏—á–Ω—ã–π –∞–¥—Ä–µ—Å: %%u
                
                REM –°–æ—Ö—Ä–∞–Ω—è–µ–º —É—Å–ø–µ—à–Ω—ã–π URL –≤ —Ñ–∞–π–ª –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
                echo %%u > "%~dp0tunnel_url.txt"
                echo üìù URL —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ tunnel_url.txt
            )
            
            echo.
            echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
            echo ‚ïë                ‚úÖ –¢–£–ù–ù–ï–õ–¨ –ê–ö–¢–ò–í–ï–ù              ‚ïë
            echo ‚ïë                                                ‚ïë
            echo ‚ïë  üåê –õ–æ–∫–∞–ª—å–Ω—ã–π:  http://localhost:5000         ‚ïë
            echo ‚ïë  üåç –ü—É–±–ª–∏—á–Ω—ã–π:  http://%%s.loca.lt     ‚ïë
            echo ‚ïë                                                ‚ïë
            echo ‚ïë  üìù URL —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ tunnel_url.txt              ‚ïë
            echo ‚ïë  ‚ö†Ô∏è  –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ!                   ‚ïë
            echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            echo.
            
            REM –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—É–Ω–Ω–µ–ª—è
            goto MONITOR
        )
    )
    
    echo ‚ùå –°—É–±–¥–æ–º–µ–Ω %%s –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –∑–∞–Ω—è—Ç
    
    REM –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å LocalTunnel –¥–ª—è —ç—Ç–æ–π –ø–æ–ø—ã—Ç–∫–∏
    taskkill /f /im node.exe >nul 2>&1
    timeout /t 2 /nobreak >nul
)

echo.
echo ‚ùå –í—Å–µ —Å—É–±–¥–æ–º–µ–Ω—ã –∑–∞–Ω—è—Ç—ã –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!
echo üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
echo    1. –ü–æ–¥–æ–∂–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
echo    2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å —Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è
echo    3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å —Å–ª—É—á–∞–π–Ω—ã–º —Å—É–±–¥–æ–º–µ–Ω–æ–º: lt --port 5000
pause
exit /b 1

:MONITOR
echo üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—É–Ω–Ω–µ–ª—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)...
echo ‚è∞ %date% %time%

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
curl -s http://localhost:5000 >nul 2>&1
if errorlevel 1 (
    echo ‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!
) else (
    echo ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
)

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—É–±–ª–∏—á–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å
if exist "%~dp0tunnel_url.txt" (
    set /p TUNNEL_URL=<"%~dp0tunnel_url.txt"
    curl -s "%TUNNEL_URL%" >nul 2>&1
    if errorlevel 1 (
        echo ‚ö†Ô∏è  –ü—É–±–ª–∏—á–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    ) else (
        echo ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç
    )
)

echo.
timeout /t 30 /nobreak >nul
goto MONITOR
